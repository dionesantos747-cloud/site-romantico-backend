<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nosso Amor ğŸ’–</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="preview azul" id="preview">
  <audio id="audioPlayer" controls style="display:none;"></audio>

  <div class="nome" id="nome"></div>
  <div class="mensagem" id="mensagem"></div>
  <div id="midias"></div>

  <div id="tempo"></div>

  <button id="btnCarta">ğŸ’Œ Abrir carta</button>
  <div class="carta" id="carta"></div>
</div>

<script>
/* =====================
   CARREGAR DADOS DO USUÃRIO
===================== */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id) {
  document.body.innerHTML = `
    <div style="text-align:center;color:white;padding:40px">
      <h1>ID invÃ¡lido</h1>
    </div>`;
  throw new Error("ID ausente");
}

fetch(`/user-data?id=${id}`)
  .then(res => res.json())
  .then(data => {

    /* ğŸ”’ SITE NÃƒO ATIVADO */
    if (!data || data.status === "pending") {
      document.body.innerHTML = `
        <div style="text-align:center;color:white;padding:40px">
          <h1>ğŸ’” Site indisponÃ­vel</h1>
          <p>Este site ainda nÃ£o foi ativado.</p>
        </div>`;
      return;
    }

    /* ğŸ”´ SEGURANÃ‡A */
    if (!data.nome) {
      document.body.innerHTML = `
        <div style="text-align:center;color:white;padding:40px">
          <h1>Site nÃ£o encontrado</h1>
        </div>`;
      return;
    }

    /* ===== ELEMENTOS ===== */
    const nomeEl = document.getElementById("nome");
    const msgEl = document.getElementById("mensagem");
    const cartaEl = document.getElementById("carta");
    const midiasEl = document.getElementById("midias");
    const audio = document.getElementById("audioPlayer");
    const tempoEl = document.getElementById("tempo");
    const preview = document.getElementById("preview");

    /* ===== TEXTO ===== */
    nomeEl.innerText = data.nome || "";
    msgEl.innerText = data.mensagem || "";
    cartaEl.innerText = data.carta || "";

    /* ===== FUNDO ===== */
    if (data.fundo) {
      preview.className = "preview " + data.fundo;
    }

    /* ===== FOTOS ===== */
    if (Array.isArray(data.fotos) && data.fotos.filter(Boolean).length > 0) {
      data.fotos.forEach(url => {
        if (url) {
          const div = document.createElement("div");
          div.className = "photo";
          div.innerHTML = `<img src="${url}" style="width:100%">`;
          midiasEl.appendChild(div);
        }
      });
    } else {
      midiasEl.innerHTML = `
        <p style="opacity:.7;font-style:italic;margin-top:16px">
          ğŸ’– Cada momento aqui Ã© especial
        </p>`;
    }

    /* ===== MÃšSICA ===== */
if (data.musica) {
  audio.src = data.musica;
  audio.style.display = "block";
  audio.volume = 0.8; // ğŸ”Š volume inicial
}

    /* ===== CONTADOR ===== */
    if (data.dataInicio) {
      setInterval(() => {
        const inicio = new Date(data.dataInicio);
        const agora = new Date();
        const diff = agora - inicio;
        if (diff < 0) return;

        const s = Math.floor(diff / 1000) % 60;
        const m = Math.floor(diff / 60000) % 60;
        const h = Math.floor(diff / 3600000) % 24;
        const d = Math.floor(diff / 86400000) % 30;
        const mo = Math.floor(diff / 2592000000) % 12;
        const a = Math.floor(diff / 31536000000);

        const anoText = a === 1 ? "ano" : "anos";
        const mesText = mo === 1 ? "mÃªs" : "meses";
        const diaText = d === 1 ? "dia" : "dias";

        tempoEl.innerHTML = `
          <span class="titulo">JÃ¡ estamos juntos hÃ¡</span>
          <div class="contador">
            <div class="item">${a} ${anoText}</div>
            <div class="item">${mo} ${mesText}</div>
            <div class="item">${d} ${diaText}</div>
            <div class="item">${h}h ${m}m ${s}s</div>
          </div>
        `;
      }, 1000);
    }
  });

/* =====================
   CARTA
===================== */
const btnCarta = document.getElementById("btnCarta");
const carta = document.getElementById("carta");

btnCarta.onclick = () => {
  carta.style.display = carta.style.display === "block" ? "none" : "block";
  btnCarta.innerText =
    carta.style.display === "block"
      ? "âŒ Fechar carta"
      : "ğŸ’Œ Abrir carta";
};

/* =====================
   CORAÃ‡Ã•ES
===================== */
function criarCoracoes() {
  document.querySelectorAll(".heart").forEach(h => h.remove());
  for (let i = 0; i < 12; i++) {
    const h = document.createElement("div");
    h.className = "heart";
    h.innerText = "â¤ï¸";
    h.style.left = Math.random() * 100 + "%";
    h.style.animationDuration = 6 + Math.random() * 6 + "s";
    document.getElementById("preview").appendChild(h);
  }
}
criarCoracoes();
</script>

</body>
</html>
