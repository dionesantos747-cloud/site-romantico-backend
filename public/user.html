<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nosso Amor üíñ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="preview azul" id="preview">
  <audio id="audioPlayer" controls style="display:none;"></audio>

  <div class="nome" id="nome"></div>
  <div class="mensagem" id="mensagem"></div>
  <div id="midias"></div>

  <div id="tempo"></div>

  <button id="btnCarta">üíå Abrir carta</button>
  <div class="carta" id="carta"></div>
</div>

<script>
/* =====================
   CARREGAR DADOS DO USU√ÅRIO
===================== */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if(!id){
  document.body.innerHTML = "<h2>ID inv√°lido</h2>";
  throw new Error("ID ausente");
}

fetch(`/user-data?id=${id}`)
  .then(res => res.json())
  .then(data => {

    if(!data || !data.nome){
      document.body.innerHTML = `
        <div style="text-align:center;color:white;padding:40px">
          <h1>Site n√£o encontrado üíî</h1>
          <p>Este link pode estar incorreto ou expirado.</p>
        </div>`;
      return;
    }

    // ===== ELEMENTOS =====
    const nomeEl = document.getElementById("nome");
    const msgEl = document.getElementById("mensagem");
    const cartaEl = document.getElementById("carta");
    const midiasEl = document.getElementById("midias");
    const audio = document.getElementById("audioPlayer");
    const tempoEl = document.getElementById("tempo");

    // ===== TEXTO =====
    nomeEl.innerText = data.nome;
    msgEl.innerText = data.mensagem;
    cartaEl.innerText = data.carta;

    // ===== FOTOS =====
    if(Array.isArray(data.fotos)){
      data.fotos.forEach(url => {
        if(url){
          const div = document.createElement("div");
          div.className = "photo";
          div.innerHTML = `<img src="${url}" style="width:100%">`;
          midiasEl.appendChild(div);
        }
      });
    }

    // ===== M√öSICA =====
    if(data.musica){
      audio.src = data.musica;
      audio.style.display = "block";
    }

    // ===== CONTADOR =====
    if(data.dataInicio){
      setInterval(()=>{
        const inicio = new Date(data.dataInicio);
        const agora = new Date();
        const diff = agora - inicio;
        if(diff < 0) return;

        const s = Math.floor(diff/1000)%60;
        const m = Math.floor(diff/60000)%60;
        const h = Math.floor(diff/3600000)%24;
        const d = Math.floor(diff/86400000)%30;
        const mo = Math.floor(diff/2592000000)%12;
        const a = Math.floor(diff/31536000000);

        const anoText = a===1?"ano":"anos";
        const mesText = mo===1?"m√™s":"meses";
        const diaText = d===1?"dia":"dias";

        tempoEl.innerHTML = `
          <span class="titulo">J√° estamos juntos h√°</span>
          <div class="contador">
            <div class="item">${a} ${anoText}</div>
            <div class="item">${mo} ${mesText}</div>
            <div class="item">${d} ${diaText}</div>
            <div class="item">${h}h ${m}m ${s}s</div>
          </div>
        `;
      },1000);
    }
  });

/* =====================
   CARTA
===================== */
const btnCarta = document.getElementById("btnCarta");
const carta = document.getElementById("carta");

btnCarta.onclick = () => {
  carta.style.display = carta.style.display==="block"?"none":"block";
  btnCarta.innerText =
    carta.style.display==="block"
      ? "‚ùå Fechar carta"
      : "üíå Abrir carta";
};

/* =====================
   CORA√á√ïES
===================== */
function criarCoracoes(){
  document.querySelectorAll(".heart").forEach(h=>h.remove());
  for(let i=0;i<12;i++){
    const h=document.createElement("div");
    h.className="heart";
    h.innerText="‚ù§Ô∏è";
    h.style.left = Math.random()*100+"%";
    h.style.animationDuration = 6+Math.random()*6+"s";
    document.getElementById("preview").appendChild(h);
  }
}
criarCoracoes();
</script>

</body>
</html>

