<!DOCTYPE html>  <html lang="pt-BR">  
<head>  
<meta charset="UTF-8">  
<title>Site Rom√¢ntico</title>  
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> 
<meta name="color-scheme" content="only light">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet"> 
  
  <style>  
*{box-sizing:border-box}  
body{  
  margin:0;  
  background:#000;  
  color:#fff;  
  font-family:Arial,sans-serif;  
  overflow-x:hidden;  
  touch-action:manipulation;  
}
  
.editor{  
  padding:20px;  
  background:#0d0f18;  
}  
  
label{  
  color:#ffb3d9;  
  display:block;  
  margin:14px 0 6px;  
}  
  
input,textarea{  
  width:100%;  
  padding:14px;  
  border-radius:14px;  
  border:none;  
  font-size:1em;  
}  
  
input.error,textarea.error{  
  border:2px solid red;  
}  
  
.error-text{  
  color:red;  
  font-size:.9em;  
  margin-top:4px;  
  display:none;  
}  
  
textarea{min-height:90px}  
  
/* FUNDOS */  
.bg-options{  
  display:flex;  
  gap:12px;  
  justify-content:center;  
  flex-wrap:wrap;  
}  
.bg-card{  
  width:60px;  
  height:60px;  
  border-radius:14px;  
  border:3px solid #000;  
  cursor:pointer;  
}  
.bg-card.selected{  
  border:3px solid #fff;  
}  
.azul{background:radial-gradient(circle,#2b6cff,#000)}  
.roxo{background:radial-gradient(circle,#8a5cff,#000)}  
.rosa{background:radial-gradient(circle,#ff5fa2,#000)}  
.preto{background:radial-gradient(circle,#222,#000)}  
  
/* FOTOS */  
.photo-grid{  
  display:flex;  
  gap:10px;  
  justify-content:center;  
}  
.photo-slot{  
  width:90px;  
  height:90px;  
  border-radius:18px;  
  border:2px dashed #777;  
  display:flex;  
  align-items:center;  
  justify-content:center;  
  font-size:2em;  
  cursor:pointer;  
  position:relative;  
}  
.photo-slot.filled{cursor:default}  
  
.photo-remove{  
  position:absolute;  
  top:-8px;  
  right:-8px;  
  background:#ff4b4b;  
  color:#fff;  
  border-radius:50%;  
  width:22px;  
  height:22px;  
  display:flex;  
  align-items:center;  
  justify-content:center;  
  font-size:14px;  
  cursor:pointer;  
}  
    
  
/* M√öSICA */  
#audioPlayer {  
  display: block;  
  margin: 0 auto 20px;  
  width: 80%;  
  max-width: 300px;  
}  
.music-box{  
  margin-top:12px;  
  background:#222;  
  padding:14px;  
  border-radius:14px;  
  text-align:center;  
  cursor:pointer;  
}  
.music-box.disabled{  
  opacity:.7;  
  cursor:default;  
}  
  
.remove-music{  
  display:none;  
  margin-top:8px;  
  color:#ff4b4b;  
  text-align:center;  
  cursor:pointer;  
}  
  
/* PREVIEW */  
.preview{  
  min-height:100vh;  
  padding:40px 16px 160px;  
  text-align:center;  
  position:relative;  
  overflow:hidden;  
}  
  
/* NOME COM MESMA FONTE DO CONTADOR, COR AMARELA, BRILHO LEVE, PULSANTE LENTO */  
.nome{  
  font-family:'Playfair Display', serif;  
  font-size:3em;  
  font-weight:bold;  
  color:#ffd400;  
  text-shadow: 0 0 6px #ffd400, 1px 1px 3px #000;  
  display:inline-block;  
  animation: pulseNome 3s infinite;  
}  
  
@keyframes pulseNome{  
  0%{transform: scale(1);}  
  50%{transform: scale(1.05);}  
  100%{transform: scale(1);}  
}  
  
/* MENSAGEM PRINCIPAL LEG√çVEL INCLINADA */  
.mensagem{  
  font-family:'Playfair Display', serif;  
  font-size:1.8em;  
  font-style:italic;  
  color:#fff;  
  text-shadow: 1px 1px 3px rgba(0,0,0,0.5);  
}  
  /* üì± TEXTO PRINCIPAL ADAPTADO AO MOBILE */
@media (max-width: 480px) {
  .mensagem {
    font-size: 1.2em;   /* üî• menor */
    line-height: 1.4;
    padding: 0 6px;
  }
}
/* üîí TEXTO PRINCIPAL LIMITADO */
.mensagem.limitada {
  max-height: 180px;
  overflow: hidden;
  position: relative;
}
/* ===== TEXTO COM "CONTINUAR LENDO" ===== */
.mensagem {
  font-family: 'Playfair Display', serif;
  font-size: 1.4em;          /* üîΩ menor no mobile */
  font-style: italic;
  color: #fff;
  line-height: 1.4;
  margin-top: 12px;

  display: -webkit-box;
  -webkit-line-clamp: 4;     /* üëà quantas linhas aparecem */
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.ler-mais {
  background: transparent;
  border: none;
  color: #ffd400;
  font-size: 0.95em;
  margin-top: 6px;
  cursor: pointer;
}

/* quando expandido */
.mensagem.expandido {
  -webkit-line-clamp: unset;
  max-height: none;
}

/* fade no final */
.mensagem.limitada::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 50px;
  background: linear-gradient(
    to bottom,
    rgba(0,0,0,0),
    rgba(0,0,0,0.85)
  );
}
.continuar-mensagem {
  display: none;
  margin-top: 8px;
  font-size: 0.9em;
  color: #ffd400;
  cursor: pointer;
  text-align: center;
  opacity: 0.9;
}

.carta{  
  background:#fff;  
  color:#333;  
  padding:22px;  
  border-radius:20px;  
  margin-top:20px;  
  display:none;  
  max-height:70vh;  
  overflow-y:auto;  
}  
  
button{  
  width:100%;  
  padding:18px;  
  border:none;  
  border-radius:18px;  
  font-size:1.1em;  
  margin-top:18px;  
}  
  
.pay{  
  background:#ffd400;  
  color:#000;  
  font-weight:bold;  
  animation:pulse 1.4s infinite;  
}  
@keyframes pulse{  
  0%{box-shadow:0 0 0 0 rgba(255,212,0,.6)}  
  70%{box-shadow:0 0 0 14px rgba(255,212,0,0)}  
  100%{box-shadow:0 0 0 0 rgba(255,212,0,0)}  
}  
  
/* CORA√á√ïES */  
.heart{  
  position:absolute;  
  bottom:-20px;  
  font-size:18px;  
  opacity:.6;  
  animation:float 8s linear infinite;  
  pointer-events:none;  
}  
@keyframes float{  
  to{transform:translateY(-120vh);opacity:0}  
}  
  
/* CONTADOR ESTILIZADO */  
#tempo{  
  margin-top:20px;  
  text-align:center;  
}  
  
#tempo .titulo{  
  font-family: 'Playfair Display', serif;  
  font-size:2.2em;  
  font-weight:bold;  
  margin-bottom:12px;  
  display:block;  
  color:#ffd400;  
  text-shadow: 2px 2px 4px #000;  
}  
  /* üîß AJUSTE SOMENTE NA PR√â-VISUALIZA√á√ÉO */
.device-screen #tempo .titulo {
  font-size: 1.4em;   /* üî• menor */
  margin-bottom: 8px;
}
#tempo .contador{  
  display:flex;  
  justify-content:center;  
  gap:12px;  
}  
  
#tempo .contador .item {
  background: #2b2b2b;
  color: #fff;

  width: 72px;              /* üîí todos iguais */
  height: 72px;             /* üîí mesma altura */

  display: flex;            /* üî• centraliza conte√∫do */
  align-items: center;
  justify-content: center;
  flex-direction: column;

  padding: 8px;
  border-radius: 14px;

  font-family: 'Playfair Display', serif;
  font-size: 1.2em;
  line-height: 1.2;
  text-align: center;

  box-shadow: 0 4px 10px rgba(0,0,0,.45);
}

/* üîß CONTADOR MAIS COMPACTO NO CELULAR */
.device-screen #tempo .contador {
  gap: 8px;
}

.device-screen #tempo .contador .item {
  font-size: 1.1em;
  padding: 8px 10px;
  min-width: 70px;
}
  /* ===== BASE DO BARALHO ===== */
#midias {
  position: relative;
  height: 320px;
  overflow: hidden; /* üîí IMPORTANTE */
}
/* üîß MIDIAS MAIS COMPACTO NA PR√â-VISUALIZA√á√ÉO */
.device-screen #midias {
  height: 220px;        /* üî• menor */
  margin-top: 12px;
  margin-bottom: 12px;
}

#midias .photo {
  position: absolute;
  top: 0;
  left: 50%;
  width: 220px;
  max-width: 70vw;

  border-radius: 18px;     /* üî• quinas completas */
  overflow: hidden;        /* üî• corta a imagem */
  background: #fff;

  transform: translateX(-50%);
  transition: transform 0.45s cubic-bezier(.22,.61,.36,1);
  will-change: transform;
}

.device-screen #midias .photo {
  width: 180px;
  max-width: 85%;
}
#midias .photo {
  border-radius: 18px;
  overflow: hidden;
}

#midias .photo img {
  width: 100%;
  height: auto;
  border-radius: 18px;
  display: block;
}

#midias .photo.active { z-index: 3; }
#midias .photo.behind-1 { z-index: 2; }
#midias .photo.behind-2 { z-index: 1; }


  /* ===== CARTAS  (TINDER / BARALHO) ===== */

#midias {
  position: relative;
  height: 320px;
  overflow: hidden; /* üîí trava tudo */
}

   #midias .photo.active {
  transform: translateX(-50%);
  opacity: 1;
  z-index: 2;
}


#midias .photo.behind-1,
#midias .photo.behind-2 {
  transform: translateX(-50%);
  opacity: 0;
  pointer-events: none;
}


/* =====================
   BOLINHAS INDICADORAS
===================== */
.dots {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: -10px;
}

.dot {
  width: 8px;
  height: 8px;
  background: #777;
  border-radius: 50%;
  transition: all 0.3s;
}

.dot.active {
  background: #ffd400;
  transform: scale(1.3);
}
  /* =========================
   PREVIEW EM FORMATO CELULAR
========================= */

.device-preview {
  max-width: 380px;
  margin: 30px auto;
  border-radius: 36px;
  padding: 14px;
  background: linear-gradient(180deg, #2a7fa3, #0b2d3d);
  box-shadow: 0 20px 50px rgba(0,0,0,.6);
}

.device-top {
  height: 38px;
  background: #111;
  border-radius: 18px 18px 10px 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 8px;
}

.chrome-url {
  background: #1e1e1e;
  color: #9ad1ff;
  padding: 6px 14px;
  border-radius: 14px;
  font-size: 12px;
  font-family: Arial, sans-serif;
  opacity: 0.85;
}

.device-screen {
  background: #000;
  border-radius: 24px;
  overflow: hidden; /* üî• ISSO resolve 90% dos problemas */
}

/* üîí tudo do site fica preso ao celular */
.device-screen .preview {
  min-height: 100%;
  max-width: 100%;
  overflow-x: hidden;
  overflow-y: auto;
}


/* üîí IMPORTANTE:
   garante que o preview n√£o saia da moldura */
.device-screen .preview {
  min-height: 600px;
}
  
</style>  </head>  <body>  <div class="editor" id="editor">  <label>Nome</label>
<input id="nomeInput" placeholder="Ex: Maria ‚ù§Ô∏è">

  <div class="error-text">Campo n√£o preenchido</div>  <label>Mensagem principal</label>

  <textarea id="msgInput" placeholder="Escreva algo especial..."></textarea>    <div class="error-text">Campo n√£o preenchido</div>  <label>Carta secreta</label>

  <textarea id="cartaInput" placeholder="Mensagem s√≥ para quem ama üíå"></textarea>    <div class="error-text">Campo n√£o preenchido</div>  <label>Data de in√≠cio do namoro</label>
<input type="date" id="dataInput">

  <div class="error-text">Campo n√£o preenchido</div>  <label>Fotos</label>

  <div class="photo-grid">  
    <div class="photo-slot" data-slot="0">+</div>  
    <div class="photo-slot" data-slot="1">+</div>  
    <div class="photo-slot" data-slot="2">+</div>  
  </div>  
  <input type="file" id="fotoInput" accept="image/*" hidden>  <label>M√∫sica</label>

  <div class="music-box" id="musicBox">Adicionar m√∫sica üéµ</div>  
  <div class="remove-music" id="removeMusic">Remover m√∫sica</div>  
  <input type="file" id="musicaInput" accept="audio/*" hidden>  <label>Fundo</label>

  <div class="bg-options">  
    <div class="bg-card azul selected" data-bg="azul"></div>  
    <div class="bg-card roxo" data-bg="roxo"></div>  
    <div class="bg-card rosa" data-bg="rosa"></div>  
    <div class="bg-card preto" data-bg="preto"></div>  
  </div>  
</div> 
  <!-- üëá TEXTO EXPLICATIVO DO PREVIEW -->
<div style="
  text-align:center;
  margin: 30px 0 10px;
  font-family: 'Playfair Display', serif;
  font-size: 1.4em;
  color: #ffd400;
  text-shadow: 1px 1px 3px #000;
">
  Veja como vai ficar ‚¨áÔ∏è
</div>

  <div class="device-preview">
  <div class="device-top">
    <span class="chrome-url">memoryit.com/Eu-e-ela</span>
  </div>

  <div class="device-screen">
<!-- üîí MOLDURA DE CELULAR -->


    <!-- üî• TUDO DO SITE DO USU√ÅRIO FICA AQUI DENTRO -->
    <div class="preview azul" id="preview">

      <audio id="audioPlayer" controls style="display:none;"></audio>

      <div class="nome" id="nome"></div>
      <div class="mensagem" id="mensagem"></div>
    <button id="btnContinuarMensagem" class="ler-mais" style="display:none">
  Continuar lendo ‚¨áÔ∏è
</button>


</div>

      <div id="midias"></div>
      <div class="dots" id="dots"></div>

      <div id="tempo"></div>

      <button id="btnCarta">üíå Abrir carta</button>
      <div class="carta" id="carta"></div>

    </div>
    <!-- üîö FIM DO PREVIEW -->
    </div>
</div>
  <!-- üí≥ BOT√ÉO DE COMPRA (EDITOR APENAS) -->
 <div style="
  max-width: 420px;
  margin: 30px auto 80px;
  padding: 0 20px;
">
  <button class="pay" id="btnComprar">
    Gerar QR Code por R$9,99
  </button>
</div>
</div> <script>
const isEditor = true;

  const LIMITE_MUSICA_MB = 5; // ~2 minutos

  const nomeInput = document.getElementById("nomeInput");
  const msgInput = document.getElementById("msgInput");
  const cartaInput = document.getElementById("cartaInput");
  const dataInput = document.getElementById("dataInput");

  const nome = document.getElementById("nome");
  const mensagem = document.getElementById("mensagem");
  const carta = document.getElementById("carta");
  const tempo = document.getElementById("tempo");
  const preview = document.getElementById("preview");

  const fotoInput = document.getElementById("fotoInput");
  const midias = document.getElementById("midias");

  const dotsContainer = document.getElementById("dots");
  
  const musicBox = document.getElementById("musicBox");
  const musicaInput = document.getElementById("musicaInput");
  const audio = document.getElementById("audioPlayer");
  const removeMusic = document.getElementById("removeMusic");

  const btnCarta = document.getElementById("btnCarta");
  const btnComprar = document.getElementById("btnComprar");

  let fotos = [null, null, null];
  let slotAtual = null;
  let musicaUrl = null;
  let fundoSelecionado = "azul";
  let indexAtivo = 0;
  
function atualizarStack(index) {
  const fotos = document.querySelectorAll("#midias .photo");

  fotos.forEach((foto, i) => {
    foto.classList.toggle("active", i === 0);
  });
}


function ativarSwipe(cartas) {
  if (document.querySelectorAll("#midias .photo").length < 2) return;

  cartas.forEach(carta => {
    if (carta.dataset.swipe === "true") return;
    carta.dataset.swipe = "true";

    let startX = 0;
    let currentX = 0;
    let dragging = false;

    carta.addEventListener("pointerdown", e => {
      dragging = true;
      startX = e.clientX;
      carta.setPointerCapture(e.pointerId);
      carta.style.transition = "none";
      pararAutoSwipe(); // ‚úã pausa o autom√°tico
    });

    carta.addEventListener("pointermove", e => {
      if (!dragging) return;
      currentX = e.clientX - startX;

      carta.style.transform =
        `translateX(calc(-50% + ${currentX}px))`;
    });

    carta.addEventListener("pointerup", () => {
      dragging = false;


      if (Math.abs(currentX) > 100) {
        
   

       carta.style.transition = "transform 0.45s cubic-bezier(.22,.61,.36,1)";
carta.style.transform =
  `translateX(${currentX > 0 ? 110 : -110}vw)`;

        setTimeout(() => {
          // üîÅ LOOP SIMPLES
          midias.appendChild(carta);

          carta.style.transition = "none";
          carta.style.transform = "translateX(-50%)";

          atualizarStack(0);

          const ativa = document.querySelector("#midias .photo.active");
          if (ativa) ativarSwipe([ativa]);
        }, 250);
      } else {
        carta.style.transition = "transform 0.2s ease";
        carta.style.transform = "translateX(-50%)";
        setTimeout(iniciarAutoSwipe, 4000); // ‚ñ∂Ô∏è volta autom√°tico

      }

      currentX = 0;
    });
  });
}
/* =========================
   SWIPE AUTOM√ÅTICO SUAVE
========================= */

let autoSwipeInterval = null;
let AUTO_SWIPE_DELAY = 3500; // ‚è±Ô∏è tempo entre fotos (ms)

function iniciarAutoSwipe() {
  pararAutoSwipe(); // seguran√ßa

  autoSwipeInterval = setInterval(() => {
    const ativa = document.querySelector("#midias .photo.active");
    if (!ativa) return;

    // anima sa√≠da
    ativa.style.transition = "transform 0.35s ease";
    ativa.style.transform = "translateX(-120vw)";

    swipeSound.currentTime = 0;
    swipeSound.play();

    setTimeout(() => {
      // move para o final
      midias.appendChild(ativa);

      ativa.style.transition = "none";
      ativa.style.transform = "translateX(-50%)";

      atualizarStack(0);

      // reativa swipe manual na nova ativa
      const novaAtiva = document.querySelector("#midias .photo.active");
      if (novaAtiva) ativarSwipe([novaAtiva]);
    }, 350);

  }, AUTO_SWIPE_DELAY);
}

function pararAutoSwipe() {
  if (autoSwipeInterval) {
    clearInterval(autoSwipeInterval);
    autoSwipeInterval = null;
  }
}


function ativarDot(index) {
  if (!dotsContainer) return;

  document.querySelectorAll(".dot").forEach((dot, i) => {
    dot.classList.toggle("active", i === index);
  });
}


function criarDots() {
  if (!dotsContainer) return; // üî• PROTE√á√ÉO (AQUI)

  dotsContainer.innerHTML = "";
  const total = document.querySelectorAll("#midias .photo").length;

  for (let i = 0; i < total; i++) {
    const dot = document.createElement("div");
    dot.className = "dot";
    if (i === 0) dot.classList.add("active");
    dotsContainer.appendChild(dot);
  }
}



     /* PREVIEW TEXTO */
  nomeInput.oninput = () => nome.innerText = nomeInput.value;
  msgInput.oninput = () => mensagem.innerText = msgInput.value;
  function ajustarMensagem() {
  const msg = document.getElementById("mensagem");
  const btn = document.getElementById("btnContinuarMensagem");

  if (!msg || !btn) return;

  setTimeout(() => {
    if (msg.scrollHeight > 200) {
      msg.classList.add("limitada");
      btn.style.display = "block";
    } else {
      msg.classList.remove("limitada");
      btn.style.display = "none";
    }
  }, 50);
}
const btnContinuarMensagem = document.getElementById("btnContinuarMensagem");

if (btnContinuarMensagem) {
  btnContinuarMensagem.onclick = () => {
    mensagem.classList.remove("limitada");
    btnContinuarMensagem.style.display = "none";
  };
}

  cartaInput.oninput = () => carta.innerText = cartaInput.value;

  /* CONTADOR */
  setInterval(() => {
    if (!dataInput.value) return;

    const inicio = new Date(dataInput.value);
    const agora = new Date();
    const diff = agora - inicio;
    if (diff < 0) return;

    const s = Math.floor(diff / 1000) % 60;
    const m = Math.floor(diff / 60000) % 60;
    const h = Math.floor(diff / 3600000) % 24;
    const d = Math.floor(diff / 86400000) % 30;
    const mo = Math.floor(diff / 2592000000) % 12;
    const a = Math.floor(diff / 31536000000);

    tempo.innerHTML = `
      <span class="titulo">J√° estamos juntos h√°</span>
      <div class="contador">
        <div class="item">${a} ${a === 1 ? "ano" : "anos"}</div>
        <div class="item">${mo} ${mo === 1 ? "m√™s" : "meses"}</div>
        <div class="item">${d} ${d === 1 ? "dia" : "dias"}</div>
        <div class="item">${h}h ${m}m ${s}s</div>
      </div>
    `;
  }, 1000);

  /* CARTA */
  btnCarta.onclick = () => {
    carta.style.display = carta.style.display === "block" ? "none" : "block";
    btnCarta.innerText =
      carta.style.display === "block" ? "‚ùå Fechar carta" : "üíå Abrir carta";
  };

  /* CORA√á√ïES */
  function criarCoracoes() {
    document.querySelectorAll(".heart").forEach(h => h.remove());
    for (let i = 0; i < 12; i++) {
      const h = document.createElement("div");
      h.className = "heart";
      h.innerText = "‚ù§Ô∏è";
      h.style.left = Math.random() * 100 + "%";
      h.style.animationDuration = 6 + Math.random() * 6 + "s";
      preview.appendChild(h);
    }
  }
  criarCoracoes();

  /* FUNDOS */
  document.querySelectorAll(".bg-card").forEach(c => {
  c.onclick = () => {
  document.querySelectorAll(".bg-card").forEach(x => x.classList.remove("selected"));
  c.classList.add("selected");

  fundoSelecionado = c.dataset.bg; // üî• SALVA
  preview.className = "preview " + fundoSelecionado;
  criarCoracoes();
    };
  });

  /* UPLOADS */
  async function uploadFoto(file) {
    const f = new FormData();
    f.append("file", file);
    const r = await fetch("/upload-image", { method: "POST", body: f });
    return (await r.json()).url;
  }

  async function uploadMusica(file) {
    const f = new FormData();
    f.append("file", file);
    const r = await fetch("/upload-music", { method: "POST", body: f });
    return (await r.json()).url;
  }

  /* FOTOS */
  document.querySelectorAll(".photo-slot").forEach(slot => {
    slot.onclick = () => {
      if (slot.classList.contains("filled")) return;
      slotAtual = slot.dataset.slot;
      fotoInput.value = "";
      fotoInput.click();
    };
  });

  fotoInput.onchange = async e => {
   
   const file = e.target.files[0];
    if (!file || slotAtual === null) return;

    const cloud = await uploadFoto(file);
    fotos[slotAtual] = cloud;

    const local = URL.createObjectURL(file);
    const div = document.createElement("div");
    div.className = "photo";
 div.innerHTML = `
  <img src="${local}" 
       style="
         width:100%;
         height:auto;
         display:block;
         border-radius:16px;
       ">
`;


    const remove = document.createElement("div");
    remove.className = "photo-remove";
    remove.innerText = "√ó";
    const slotIndex = slotAtual;
    
remove.onclick = () => {
  fotos[slotIndex] = null;
  div.remove();

  const slot = document.querySelector(
    `.photo-slot[data-slot="${slotIndex}"]`
  );

  slot.classList.remove("filled");
  slot.innerText = "+";
  slotAtual = null;
  fotoInput.value = "";


  criarDots();
  atualizarStack(0);
  iniciarAutoSwipe();


};

   div.appendChild(remove);
midias.appendChild(div);



// üî• ATIVA SWIPE NA CARTA

criarDots();
setTimeout(() => {
  indexAtivo = 0;
  atualizarStack(indexAtivo);
}, 50);


   const slotEl = document.querySelector(
  `.photo-slot[data-slot="${slotAtual}"]`
);

    slotEl.classList.add("filled");
    slotEl.innerText = ""; // üî• REMOVE O "+"
    
    slotAtual = null;
    fotoInput.value = "";
  };

  /* M√öSICA */
 musicBox.onclick = () => {
  if (musicBox.classList.contains("disabled")) return;
  musicaInput.click();
};
  musicaInput.onchange = async () => {
  const file = musicaInput.files[0];
  if (!file) return;

  if (file.size > LIMITE_MUSICA_MB * 1024 * 1024) {
    alert("‚ùå M√∫sica muito grande (m√°x. 2 minutos)");
    musicaInput.value = "";
    return;
  }
musicBox.innerText = "‚è≥ Carregando m√∫sica...";
musicBox.classList.add("disabled");

  // üî• UPLOAD PARA CLOUDINARY
  const cloudUrl = await uploadMusica(file);

  // üî• PREVIEW COM URL REAL
  audio.src = cloudUrl;
  audio.volume = 0.8;
  audio.preload = "auto";
  audio.style.display = "block";

  // üî• SALVA PARA O SITE FINAL
  musicaUrl = cloudUrl;

  musicBox.innerText = "üé∂ M√∫sica selecionada";
   removeMusic.style.display = "block";
     musicBox.classList.add("disabled");
};

  /* COMPRA ‚Äî VALIDA√á√ÉO ORIGINAL */
  btnComprar.onclick = async () => {
    const campos = [nomeInput, msgInput, cartaInput, dataInput];
    let erro = false;

    campos.forEach(c => {
      const err = c.nextElementSibling;
      if (!c.value) {
        c.classList.add("error");
        if (err) err.style.display = "block";
        if (!erro) c.scrollIntoView({ behavior: "smooth" });
        erro = true;
      } else {
        c.classList.remove("error");
        if (err) err.style.display = "none";
      }
    });

    if (erro) return;

    const r = await fetch("/create-payment", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
  nome: nomeInput.value,
  mensagem: msgInput.value,
  carta: cartaInput.value,
  dataInicio: dataInput.value,
  fotos,
  musica: musicaUrl,
  fundo: document.querySelector(".bg-card.selected")?.dataset.bg || "azul"
})
    });

    const d = await r.json();
    sessionStorage.setItem("pix_qr", d.qr_base64);
    sessionStorage.setItem("pix_copia", d.copia_cola);
    location.href = `/aguardando.html?payment_id=${d.payment_id}`;
  };

</script> </body>  
</html>






















































