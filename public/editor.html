<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Site Rom√¢ntico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,sans-serif;
  overflow-x:hidden;
}

.editor{
  padding:20px;
  background:#0d0f18;
}

label{
  color:#ffb3d9;
  display:block;
  margin:14px 0 6px;
}

input,textarea{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:1em;
}

input.error,textarea.error{
  border:2px solid red;
}

.error-text{
  color:red;
  font-size:.9em;
  display:none;
}

textarea{min-height:90px}

.bg-options{
  display:flex;
  gap:12px;
  justify-content:center;
}
.bg-card{
  width:60px;height:60px;border-radius:14px;cursor:pointer;
}
.azul{background:radial-gradient(circle,#2b6cff,#000)}
.roxo{background:radial-gradient(circle,#8a5cff,#000)}
.rosa{background:radial-gradient(circle,#ff5fa2,#000)}
.preto{background:radial-gradient(circle,#222,#000)}

.preview{
  min-height:100vh;
  padding:40px 16px 140px;
  text-align:center;
}

.nome{
  font-family:'Playfair Display', serif;
  font-size:3em;
  color:#ffd400;
}

.mensagem{
  font-size:1.6em;
  font-style:italic;
}

button{
  width:100%;
  padding:18px;
  border:none;
  border-radius:18px;
  font-size:1.1em;
  margin-top:18px;
}

.pay{
  background:#ffd400;
  color:#000;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="editor">

  <label>Nome</label>
  <input id="nomeInput">
  <div class="error-text">Campo obrigat√≥rio</div>

  <label>Mensagem principal</label>
  <textarea id="msgInput"></textarea>
  <div class="error-text">Campo obrigat√≥rio</div>

  <label>Carta secreta</label>
  <textarea id="cartaInput"></textarea>
  <div class="error-text">Campo obrigat√≥rio</div>

  <label>Data de in√≠cio</label>
  <input type="date" id="dataInput">
  <div class="error-text">Campo obrigat√≥rio</div>

</div>

<div class="preview azul" id="preview">
  <div class="nome" id="nome"></div>
  <div class="mensagem" id="mensagem"></div>

  <button class="pay" id="btnComprar">Gerar QR Code por R$9,99</button>
</div>

<script>
const nomeInput = document.getElementById("nomeInput");
const msgInput = document.getElementById("msgInput");
const cartaInput = document.getElementById("cartaInput");
const dataInput = document.getElementById("dataInput");

const nome = document.getElementById("nome");
const mensagem = document.getElementById("mensagem");

nomeInput.oninput = () => nome.innerText = nomeInput.value;
msgInput.oninput = () => mensagem.innerText = msgInput.value;

/* =========================
   PAGAMENTO ‚Äì FLUXO CORRETO
========================= */
document.getElementById("btnComprar").onclick = async () => {

  const campos = [nomeInput,msgInput,cartaInput,dataInput];
  let erro = false;

  campos.forEach(c=>{
    const err = c.nextElementSibling;
    if(!c.value){
      c.classList.add("error");
      err.style.display="block";
      erro = true;
    } else {
      c.classList.remove("error");
      err.style.display="none";
    }
  });

  if(erro) return;

  const res = await fetch("/create-payment", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      nome:nomeInput.value,
      mensagem:msgInput.value,
      carta:cartaInput.value,
      dataInicio:dataInput.value
    })
  });

  const data = await res.json();

  if(!data.payment_id){
    alert("Erro ao criar pagamento");
    return;
  }

  // üöÄ REDIRECIONAMENTO FINAL
  window.location.href = `/aguardando.html?payment_id=${data.payment_id}`;
};
</script>

</body>
</html>





