<!DOCTYPE html>  <html lang="pt-BR">  
<head>  
<meta charset="UTF-8">  
<title>Site Rom√¢ntico</title>  
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> 
<meta name="color-scheme" content="only light">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">  <style>  
*{box-sizing:border-box}  
body{  
  margin:0;  
  background:#000;  
  color:#fff;  
  font-family:Arial,sans-serif;  
  overflow-x:hidden;  
  touch-action:manipulation;  
}  
  
.editor{  
  padding:20px;  
  background:#0d0f18;  
}  
  
label{  
  color:#ffb3d9;  
  display:block;  
  margin:14px 0 6px;  
}  
  
input,textarea{  
  width:100%;  
  padding:14px;  
  border-radius:14px;  
  border:none;  
  font-size:1em;  
}  
  
input.error,textarea.error{  
  border:2px solid red;  
}  
  
.error-text{  
  color:red;  
  font-size:.9em;  
  margin-top:4px;  
  display:none;  
}  
  
textarea{min-height:90px}  
  
/* FUNDOS */  
.bg-options{  
  display:flex;  
  gap:12px;  
  justify-content:center;  
  flex-wrap:wrap;  
}  
.bg-card{  
  width:60px;  
  height:60px;  
  border-radius:14px;  
  border:3px solid #000;  
  cursor:pointer;  
}  
.bg-card.selected{  
  border:3px solid #fff;  
}  
.azul{background:radial-gradient(circle,#2b6cff,#000)}  
.roxo{background:radial-gradient(circle,#8a5cff,#000)}  
.rosa{background:radial-gradient(circle,#ff5fa2,#000)}  
.preto{background:radial-gradient(circle,#222,#000)}  
  
/* FOTOS */  
.photo-grid{  
  display:flex;  
  gap:10px;  
  justify-content:center;  
}  
.photo-slot{  
  width:90px;  
  height:90px;  
  border-radius:18px;  
  border:2px dashed #777;  
  display:flex;  
  align-items:center;  
  justify-content:center;  
  font-size:2em;  
  cursor:pointer;  
  position:relative;  
}  
.photo-slot.filled{cursor:default}  
  
.photo-remove{  
  position:absolute;  
  top:-8px;  
  right:-8px;  
  background:#ff4b4b;  
  color:#fff;  
  border-radius:50%;  
  width:22px;  
  height:22px;  
  display:flex;  
  align-items:center;  
  justify-content:center;  
  font-size:14px;  
  cursor:pointer;  
}  
  
.photo{  
  background:#fff;  
  padding:8px 8px 18px;  
  border-radius:4px;  
  margin:20px auto;  
  max-width:280px;  
  box-shadow:0 0 18px rgba(255,255,255,.35);  
  animation:floatPhoto 6s ease-in-out infinite;  
}  
  
@keyframes floatPhoto{  
  0%,100%{transform:translateY(0) rotate(-1deg)}  
  50%{transform:translateY(-6px) rotate(1deg)}  
}  
  
/* M√öSICA */  
#audioPlayer {  
  display: block;  
  margin: 0 auto 20px;  
  width: 80%;  
  max-width: 300px;  
}  
.music-box{  
  margin-top:12px;  
  background:#222;  
  padding:14px;  
  border-radius:14px;  
  text-align:center;  
  cursor:pointer;  
}  
.music-box.disabled{  
  opacity:.7;  
  cursor:default;  
}  
  
.remove-music{  
  display:none;  
  margin-top:8px;  
  color:#ff4b4b;  
  text-align:center;  
  cursor:pointer;  
}  
  
/* PREVIEW */  
.preview{  
  min-height:100vh;  
  padding:40px 16px 160px;  
  text-align:center;  
  position:relative;  
  overflow:hidden;  
}  
  
/* NOME COM MESMA FONTE DO CONTADOR, COR AMARELA, BRILHO LEVE, PULSANTE LENTO */  
.nome{  
  font-family:'Playfair Display', serif;  
  font-size:3em;  
  font-weight:bold;  
  color:#ffd400;  
  text-shadow: 0 0 6px #ffd400, 1px 1px 3px #000;  
  display:inline-block;  
  animation: pulseNome 3s infinite;  
}  
  
@keyframes pulseNome{  
  0%{transform: scale(1);}  
  50%{transform: scale(1.05);}  
  100%{transform: scale(1);}  
}  
  
/* MENSAGEM PRINCIPAL LEG√çVEL INCLINADA */  
.mensagem{  
  font-family:'Playfair Display', serif;  
  font-size:1.8em;  
  font-style:italic;  
  color:#fff;  
  text-shadow: 1px 1px 3px rgba(0,0,0,0.5);  
}  
  
.carta{  
  background:#fff;  
  color:#333;  
  padding:22px;  
  border-radius:20px;  
  margin-top:20px;  
  display:none;  
  max-height:70vh;  
  overflow-y:auto;  
}  
  
button{  
  width:100%;  
  padding:18px;  
  border:none;  
  border-radius:18px;  
  font-size:1.1em;  
  margin-top:18px;  
}  
  
.pay{  
  background:#ffd400;  
  color:#000;  
  font-weight:bold;  
  animation:pulse 1.4s infinite;  
}  
@keyframes pulse{  
  0%{box-shadow:0 0 0 0 rgba(255,212,0,.6)}  
  70%{box-shadow:0 0 0 14px rgba(255,212,0,0)}  
  100%{box-shadow:0 0 0 0 rgba(255,212,0,0)}  
}  
  
/* CORA√á√ïES */  
.heart{  
  position:absolute;  
  bottom:-20px;  
  font-size:18px;  
  opacity:.6;  
  animation:float 8s linear infinite;  
  pointer-events:none;  
}  
@keyframes float{  
  to{transform:translateY(-120vh);opacity:0}  
}  
  
/* CONTADOR ESTILIZADO */  
#tempo{  
  margin-top:20px;  
  text-align:center;  
}  
  
#tempo .titulo{  
  font-family: 'Playfair Display', serif;  
  font-size:2.2em;  
  font-weight:bold;  
  margin-bottom:12px;  
  display:block;  
  color:#ffd400;  
  text-shadow: 2px 2px 4px #000;  
}  
  
#tempo .contador{  
  display:flex;  
  justify-content:center;  
  gap:12px;  
}  
  
#tempo .contador .item{  
  background:#fff;  
  color:#333;  
  padding:12px 18px;  
  border-radius:12px;  
  box-shadow:0 4px 8px rgba(0,0,0,0.4);  
  font-family: 'Playfair Display', serif;  
  font-size:1.6em;  
}
  /* =====================
   CARROSSEL DE FOTOS
===================== */
#midias {
  display: flex;
  gap: 24px;
  overflow-x: auto;
  padding: 30px 16px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
}

#midias::-webkit-scrollbar {
  display: none;
}

#midias .photo {
  flex: 0 0 80%;
  max-width: 80%;
  scroll-snap-align: center;

  position: relative;
  transition: 
    transform 0.5s ease,
    opacity 0.5s ease,
    z-index 0.5s ease;

  transform-origin: center bottom;
}

/* FOTO ATIVA (FRENTE) */
#midias .photo.active {
  transform: scale(1) rotate(0deg);
  z-index: 3;
  opacity: 1;
}

/* FOTOS ATR√ÅS */
#midias .photo.behind-1 {
  transform: scale(0.9) rotate(-6deg) translateX(-40px);
  z-index: 2;
  opacity: 0.8;
}

#midias .photo.behind-2 {
  transform: scale(0.85) rotate(6deg) translateX(40px);
  z-index: 1;
  opacity: 0.6;
}

/* =====================
   BOLINHAS INDICADORAS
===================== */
.dots {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: -10px;
}

.dot {
  width: 8px;
  height: 8px;
  background: #777;
  border-radius: 50%;
  transition: all 0.3s;
}

.dot.active {
  background: #ffd400;
  transform: scale(1.3);
}
</style>  </head>  <body>  <div class="editor" id="editor">  <label>Nome</label>
<input id="nomeInput" placeholder="Ex: Maria ‚ù§Ô∏è">

  <div class="error-text">Campo n√£o preenchido</div>  <label>Mensagem principal</label>

  <textarea id="msgInput" placeholder="Escreva algo especial..."></textarea>    <div class="error-text">Campo n√£o preenchido</div>  <label>Carta secreta</label>

  <textarea id="cartaInput" placeholder="Mensagem s√≥ para quem ama üíå"></textarea>    <div class="error-text">Campo n√£o preenchido</div>  <label>Data de in√≠cio do namoro</label>
<input type="date" id="dataInput">

  <div class="error-text">Campo n√£o preenchido</div>  <label>Fotos</label>

  <div class="photo-grid">  
    <div class="photo-slot" data-slot="0">+</div>  
    <div class="photo-slot" data-slot="1">+</div>  
    <div class="photo-slot" data-slot="2">+</div>  
  </div>  
  <input type="file" id="fotoInput" accept="image/*" hidden>  <label>M√∫sica</label>

  <div class="music-box" id="musicBox">Adicionar m√∫sica üéµ</div>  
  <div class="remove-music" id="removeMusic">Remover m√∫sica</div>  
  <input type="file" id="musicaInput" accept="audio/*" hidden>  <label>Fundo</label>

  <div class="bg-options">  
    <div class="bg-card azul selected" data-bg="azul"></div>  
    <div class="bg-card roxo" data-bg="roxo"></div>  
    <div class="bg-card rosa" data-bg="rosa"></div>  
    <div class="bg-card preto" data-bg="preto"></div>  
  </div>  
</div>  <div class="preview azul" id="preview">  
  <audio id="audioPlayer" controls style="display:none;"></audio>    <div class="nome" id="nome"></div>  
  <div class="mensagem" id="mensagem"></div>  <div id="midias"></div>
<div class="dots" id="dots"></div>    <div id="tempo"></div>  <button id="btnCarta">üíå Abrir carta</button>

  <div class="carta" id="carta"></div>  <button class="pay" id="btnComprar">Gerar QR code por R$9,99</button>

</div> <script>
document.addEventListener("DOMContentLoaded", () => {

  const LIMITE_MUSICA_MB = 5; // ~2 minutos

  const nomeInput = document.getElementById("nomeInput");
  const msgInput = document.getElementById("msgInput");
  const cartaInput = document.getElementById("cartaInput");
  const dataInput = document.getElementById("dataInput");

  const nome = document.getElementById("nome");
  const mensagem = document.getElementById("mensagem");
  const carta = document.getElementById("carta");
  const tempo = document.getElementById("tempo");
  const preview = document.getElementById("preview");

  const fotoInput = document.getElementById("fotoInput");
  const midias = document.getElementById("midias");
  const dotsContainer = document.getElementById("dots");
  
  const musicBox = document.getElementById("musicBox");
  const musicaInput = document.getElementById("musicaInput");
  const audio = document.getElementById("audioPlayer");
  const removeMusic = document.getElementById("removeMusic");

  const btnCarta = document.getElementById("btnCarta");
  const btnComprar = document.getElementById("btnComprar");

  let fotos = [null, null, null];
  let slotAtual = null;
  let musicaUrl = null;
  let fundoSelecionado = "azul";
  let indexAtivo = 0;
  
  function atualizarStack(index) {
  const fotosDOM = document.querySelectorAll("#midias .photo");

  fotosDOM.forEach((foto, i) => {
    foto.classList.remove("active", "behind-1", "behind-2");

    if (i === index) foto.classList.add("active");
    else if (i === index + 1) foto.classList.add("behind-1");
    else if (i === index + 2) foto.classList.add("behind-2");
  });
}

function ativarDot(index) {
  document.querySelectorAll(".dot").forEach((dot, i) => {
    dot.classList.toggle("active", i === index);
  });
}

function criarDots() {
  dotsContainer.innerHTML = "";
  const fotosDOM = document.querySelectorAll("#midias .photo");

  fotosDOM.forEach((_, i) => {
    const dot = document.createElement("div");
    dot.className = "dot";
    if (i === 0) dot.classList.add("active");

    dot.onclick = () => {
      fotosDOM[i].scrollIntoView({ behavior: "smooth", inline: "center" });
    };

    dotsContainer.appendChild(dot);
  });
}
midias.addEventListener("scroll", () => {
  const fotosDOM = document.querySelectorAll("#midias .photo");
  if (!fotosDOM.length) return;

  indexAtivo = 0;

  fotosDOM.forEach((foto, i) => {
    const rect = foto.getBoundingClientRect();
    if (rect.left >= 0 && rect.left < window.innerWidth / 2) {
      indexAtivo = i;
    }
  });

  atualizarStack(indexAtivo);
  ativarDot(indexAtivo);
});

     /* PREVIEW TEXTO */
  nomeInput.oninput = () => nome.innerText = nomeInput.value;
  msgInput.oninput = () => mensagem.innerText = msgInput.value;
  cartaInput.oninput = () => carta.innerText = cartaInput.value;

  /* CONTADOR */
  setInterval(() => {
    if (!dataInput.value) return;

    const inicio = new Date(dataInput.value);
    const agora = new Date();
    const diff = agora - inicio;
    if (diff < 0) return;

    const s = Math.floor(diff / 1000) % 60;
    const m = Math.floor(diff / 60000) % 60;
    const h = Math.floor(diff / 3600000) % 24;
    const d = Math.floor(diff / 86400000) % 30;
    const mo = Math.floor(diff / 2592000000) % 12;
    const a = Math.floor(diff / 31536000000);

    tempo.innerHTML = `
      <span class="titulo">J√° estamos juntos h√°</span>
      <div class="contador">
        <div class="item">${a} ${a === 1 ? "ano" : "anos"}</div>
        <div class="item">${mo} ${mo === 1 ? "m√™s" : "meses"}</div>
        <div class="item">${d} ${d === 1 ? "dia" : "dias"}</div>
        <div class="item">${h}h ${m}m ${s}s</div>
      </div>
    `;
  }, 1000);

  /* CARTA */
  btnCarta.onclick = () => {
    carta.style.display = carta.style.display === "block" ? "none" : "block";
    btnCarta.innerText =
      carta.style.display === "block" ? "‚ùå Fechar carta" : "üíå Abrir carta";
  };

  /* CORA√á√ïES */
  function criarCoracoes() {
    document.querySelectorAll(".heart").forEach(h => h.remove());
    for (let i = 0; i < 12; i++) {
      const h = document.createElement("div");
      h.className = "heart";
      h.innerText = "‚ù§Ô∏è";
      h.style.left = Math.random() * 100 + "%";
      h.style.animationDuration = 6 + Math.random() * 6 + "s";
      preview.appendChild(h);
    }
  }
  criarCoracoes();

  /* FUNDOS */
  document.querySelectorAll(".bg-card").forEach(c => {
  c.onclick = () => {
  document.querySelectorAll(".bg-card").forEach(x => x.classList.remove("selected"));
  c.classList.add("selected");

  fundoSelecionado = c.dataset.bg; // üî• SALVA
  preview.className = "preview " + fundoSelecionado;
      preview.className = "preview " + c.dataset.bg;
      criarCoracoes();
    };
  });

  /* UPLOADS */
  async function uploadFoto(file) {
    const f = new FormData();
    f.append("file", file);
    const r = await fetch("/upload-image", { method: "POST", body: f });
    return (await r.json()).url;
  }

  async function uploadMusica(file) {
    const f = new FormData();
    f.append("file", file);
    const r = await fetch("/upload-music", { method: "POST", body: f });
    return (await r.json()).url;
  }

  /* FOTOS */
  document.querySelectorAll(".photo-slot").forEach(slot => {
    slot.onclick = () => {
      if (slot.classList.contains("filled")) return;
      slotAtual = slot.dataset.slot;
      fotoInput.value = "";
      fotoInput.click();
    };
  });

  fotoInput.onchange = async e => {
    const file = e.target.files[0];
    if (!file || slotAtual === null) return;

    const cloud = await uploadFoto(file);
    fotos[slotAtual] = cloud;

    const local = URL.createObjectURL(file);
    const div = document.createElement("div");
    div.className = "photo";
    div.innerHTML = `<img src="${local}" style="width:100%">`;

    const remove = document.createElement("div");
    remove.className = "photo-remove";
    remove.innerText = "√ó";
    const slotIndex = slotAtual;
    
remove.onclick = () => {
  fotos[slotIndex] = null;
  div.remove();

  const slot = document.querySelector(
    `.photo-slot[data-slot="${slotIndex}"]`
  );

  // üî• reset visual
  slot.classList.remove("filled");
  slot.innerText = "+";

  // üî• reset l√≥gico
  slotAtual = null;
  fotoInput.value = "";

  // üî• reajusta o stack
  atualizarStack(0);
};

    div.appendChild(remove);
    midias.appendChild(div);
    atualizarStack(0);
    midias.scrollIntoView({ behavior: "smooth" });
criarDots();
    atualizarStack(0);
   const slotEl = document.querySelector(
  `.photo-slot[data-slot="${slotAtual}"]`
);

slotEl.classList.add("filled");
slotEl.innerText = ""; // üî• REMOVE O "+"

    slotAtual = null;
    fotoInput.value = "";
  };

  /* M√öSICA */
  musicBox.onclick = () => musicaInput.click();

  musicaInput.onchange = async () => {
    const file = musicaInput.files[0];
    if (!file) return;

    if (file.size > LIMITE_MUSICA_MB * 1024 * 1024) {
      alert("‚ùå M√∫sica muito grande (m√°x. 2 minutos)");
      musicaInput.value = "";
      return;
    }

    // preview imediato
    audio.src = URL.createObjectURL(file);
    audio.volume = 0.8;
    audio.preload = "auto";
    audio.style.display = "block";
    audio.play();

    // upload
    musicaUrl = await uploadMusica(file);

    musicBox.innerText = "üé∂ M√∫sica selecionada";
    musicBox.classList.add("disabled");
    removeMusic.style.display = "block";
  };

  removeMusic.onclick = () => {
    audio.src = "";
    audio.style.display = "none";
    musicaInput.value = "";
    musicBox.innerText = "Adicionar m√∫sica üéµ";
    musicBox.classList.remove("disabled");
    removeMusic.style.display = "none";
    musicaUrl = null;
  };

  /* COMPRA ‚Äî VALIDA√á√ÉO ORIGINAL */
  btnComprar.onclick = async () => {
    const campos = [nomeInput, msgInput, cartaInput, dataInput];
    let erro = false;

    campos.forEach(c => {
      const err = c.nextElementSibling;
      if (!c.value) {
        c.classList.add("error");
        if (err) err.style.display = "block";
        if (!erro) c.scrollIntoView({ behavior: "smooth" });
        erro = true;
      } else {
        c.classList.remove("error");
        if (err) err.style.display = "none";
      }
    });

    if (erro) return;

    const r = await fetch("/create-payment", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
  nome: nomeInput.value,
  mensagem: msgInput.value,
  carta: cartaInput.value,
  dataInicio: dataInput.value,
  fotos,
  musica: musicaUrl,
  fundo: document.querySelector(".bg-card.selected")?.dataset.bg || "azul"
})
    });

    const d = await r.json();
    sessionStorage.setItem("pix_qr", d.qr_base64);
    sessionStorage.setItem("pix_copia", d.copia_cola);
    location.href = `/aguardando.html?payment_id=${d.payment_id}`;
  };

});
</script> </body>  
</html>





















