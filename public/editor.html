<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Site Rom√¢ntico - Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="editor" id="editor">
  <label>Nome</label>
  <input id="nomeInput" placeholder="Ex: Maria ‚ù§Ô∏è">
  <div class="error-text">Campo n√£o preenchido</div>

  <label>Mensagem principal</label>
  <textarea id="msgInput" placeholder="Escreva algo especial..."></textarea>
  <div class="error-text">Campo n√£o preenchido</div>

  <label>Carta secreta</label>
  <textarea id="cartaInput" placeholder="Mensagem s√≥ para quem ama üíå"></textarea>
  <div class="error-text">Campo n√£o preenchido</div>

  <label>Data de in√≠cio do namoro</label>
  <input type="date" id="dataInput">
  <div class="error-text">Campo n√£o preenchido</div>

  <label>Fotos</label>
  <div class="photo-grid">
    <div class="photo-slot" data-slot="0">+</div>
    <div class="photo-slot" data-slot="1">+</div>
    <div class="photo-slot" data-slot="2">+</div>
  </div>
  <input type="file" id="fotoInput" accept="image/*" hidden>

  <label>M√∫sica</label>
  <div class="music-box" id="musicBox">Adicionar m√∫sica üéµ</div>
  <div class="remove-music" id="removeMusic">Remover m√∫sica</div>
  <input type="file" id="musicaInput" accept="audio/*" hidden>

  <label>Fundo</label>
  <div class="bg-options">
    <div class="bg-card azul selected" data-bg="azul"></div>
    <div class="bg-card roxo" data-bg="roxo"></div>
    <div class="bg-card rosa" data-bg="rosa"></div>
    <div class="bg-card preto" data-bg="preto"></div>
  </div>

  <button class="pay" id="btnComprar">Gerar Link e Pagar</button>
</div>

<script src="js/main.js"></script>
<script>
document.getElementById("btnComprar").onclick = async () => {
  const campos = [nomeInput,msgInput,cartaInput,dataInput];
  let erro = false;
  campos.forEach(c => {
    const err = c.nextElementSibling;
    if(!c.value){
      c.classList.add("error");
      err.style.display="block";
      erro = true;
    } else {
      c.classList.remove("error");
      err.style.display="none";
    }
  });
  if(erro) return;

  // Preparar fotos e m√∫sica (base64 ou nomes tempor√°rios)
  const fotosData = fotos.map(f => f || null);
  const musicaData = musicaInput.files[0] ? musicaInput.files[0].name : null;

  // POST para /create
  const res = await fetch("/create", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({
      nome: nomeInput.value,
      mensagem: msgInput.value,
      carta: cartaInput.value,
      dataInicio: dataInput.value,
      fotos: fotosData,
      musica: musicaData
    })
  });
  const data = await res.json();
  
  // Abrir link de pagamento Mercado Pago
  window.open("https://www.mercadopago.com.br/payment-link/v1/go?link-id=cd18cc0f-3041-4781-8b63-353ccce8c504&external_reference="+data.id,"_blank");

  // Redirecionar para success.html com QR code
  window.location.href = `/success.html?id=${data.id}`;
};
</script>
</body>
</html>
